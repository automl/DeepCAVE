<!DOCTYPE html>

<html lang="en" data-content_root="../../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>deepcave.evaluators.epm.fanova_forest &#8212; DeepCAVE Documentation 1.3.3 documentation</title>
    
  <link href="../../../../_static/css/theme.css" rel="stylesheet">
  <link href="../../../../_static/css/index.ac9c05f7c49ca1e1f876c6e36360ea26.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/css/custom.css?v=2eb4fb78" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/sg_gallery.css?v=d2d258e8" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/sg_gallery-binder.css?v=f4aeca0c" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/sg_gallery-dataframe.css?v=2082cf3c" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
    
  <link rel="preload" as="script" href="../../../../_static/js/index.9ea38e314b9e6d9dab77.js">

    <script src="../../../../_static/documentation_options.js?v=c35e6b01"></script>
    <script src="../../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="icon" href="../../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    
  <a class="navbar-brand" href="../../../../index.html">
  <!-- <p class="title">DeepCAVE Documentation</p> -->
  </a>

    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/automl/DeepCAVE" rel="noopener" target="_blank" title="GitHub">
            <span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://twitter.com/automl_org?lang=de" rel="noopener" target="_blank" title="Twitter">
            <span><i class="fab fa-twitter-square"></i></span>
            <label class="sr-only">Twitter</label>
          </a>
        </li>
      </ul>
      </div>
      
      <div class="navbar-end-item">
        <div class="dropdown mt-1">
    <button type="button" class="btn btn-secondary btn-md navbar-btn dropdown-toggle" id="dLabelMore"
        data-toggle="dropdown">
        v1.3.3
        <span class="caret"></span>
    </button>
    <div class="dropdown-menu list-group-flush py-0" aria-labelledby="dLabelMore">
        <a class="list-group-item list-group-item-action" href="#">v1.3.3</a>
    </div>
</div>
      </div>
      
      <div class="navbar-end-item">
        <form class="bd-search align-items-center" action="../../../../search.html" method="get" style="width: 100%;">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control btn btn-md" name="q" id="search-input"
    placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off">
</form>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar"><h4 class="mt-0 mb-0"><a href="../../../../index.html">DeepCAVE Documentation</a></h4>
<div class="mb-3">v1.3.3</div><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../installation.html">
   Installation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../getting_started.html">
   Getting Started
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../../examples/index.html">
   Examples
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../../../examples/api/index.html">
     API
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
    <label for="toctree-checkbox-2">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../../examples/api/pdp.html">
       Partial Dependencies
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../../examples/api/parallel_coordinates.html">
       Parallel Coordinates
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../../examples/api/importances.html">
       Importances
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../../examples/api/ablation_paths.html">
       Ablation Paths
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../../../examples/record/index.html">
     Record
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
    <label for="toctree-checkbox-3">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../../examples/record/minimal.html">
       Record Minimal Run
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../../examples/record/digits_sklearn.html">
       Multi-Layer Perceptron via Sklearn
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../../examples/record/mnist_pytorch.html">
       Multi-Layer Perceptron via PyTorch
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../../plugins/index.html">
   Displaying Data with Plugins
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../../plugins/overview.html">
     Overview
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../../plugins/configurations.html">
     Configurations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../../plugins/configuration_footprint.html">
     Configuration Footprint
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../../plugins/cost_over_time.html">
     Cost Over Time
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../../plugins/pareto_front.html">
     Pareto Front
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../../plugins/budget_correlation.html">
     Budget Correlation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../../plugins/importances.html">
     Importances
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../../plugins/ablation_paths.html">
     Ablation Paths
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../../plugins/configuration_cube.html">
     Configuration Cube
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../../plugins/parallel_coordinates.html">
     Parallel Coordinates
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../../plugins/partial_dependencies.html">
     Partial Dependencies
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../../plugins/symbolic_explanations.html">
     Symbolic Explanations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../../plugins/custom_plugins.html">
     Adding a Plugin
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../../converters/index.html">
   Runs and Converters
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../../converters/smac.html">
     SMAC
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../../converters/amltk.html">
     AMLTK
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../../converters/optuna.html">
     Optuna
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../../converters/bohb.html">
     BOHB
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../../converters/deepcave.html">
     DeepCAVE
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../../converters/dataframe.html">
     Pandas DataFrame
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../../converters/custom_converters.html">
     Adding a Converter
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../how_to_contribute.html">
   How to Contribute
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../../api.html">
   API References
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../../../api/deepcave.runs.html">
     deepcave.runs
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
    <label for="toctree-checkbox-7">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../../../../api/deepcave.runs.converters.html">
       deepcave.runs.converters
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
      <label for="toctree-checkbox-8">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../../api/deepcave.runs.converters.amltk.html">
         deepcave.runs.converters.amltk
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../../api/deepcave.runs.converters.bohb.html">
         deepcave.runs.converters.bohb
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../../api/deepcave.runs.converters.dataframe.html">
         deepcave.runs.converters.dataframe
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../../api/deepcave.runs.converters.deepcave.html">
         deepcave.runs.converters.deepcave
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../../api/deepcave.runs.converters.optuna.html">
         deepcave.runs.converters.optuna
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../../api/deepcave.runs.converters.smac3v1.html">
         deepcave.runs.converters.smac3v1
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../../api/deepcave.runs.converters.smac3v2.html">
         deepcave.runs.converters.smac3v2
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../../api/deepcave.runs.exceptions.html">
       deepcave.runs.exceptions
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../../api/deepcave.runs.group.html">
       deepcave.runs.group
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../../api/deepcave.runs.handler.html">
       deepcave.runs.handler
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../../api/deepcave.runs.objective.html">
       deepcave.runs.objective
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../../api/deepcave.runs.recorder.html">
       deepcave.runs.recorder
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../../api/deepcave.runs.run.html">
       deepcave.runs.run
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../../api/deepcave.runs.status.html">
       deepcave.runs.status
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../../api/deepcave.runs.trial.html">
       deepcave.runs.trial
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../../../api/deepcave.plugins.html">
     deepcave.plugins
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
    <label for="toctree-checkbox-9">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../../api/deepcave.plugins.budget.html">
       deepcave.plugins.budget
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../../api/deepcave.plugins.dynamic.html">
       deepcave.plugins.dynamic
      </a>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../../../../api/deepcave.plugins.hyperparameter.html">
       deepcave.plugins.hyperparameter
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
      <label for="toctree-checkbox-10">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../../api/deepcave.plugins.hyperparameter.ablation_paths.html">
         deepcave.plugins.hyperparameter.ablation_paths
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../../api/deepcave.plugins.hyperparameter.configuration_cube.html">
         deepcave.plugins.hyperparameter.configuration_cube
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../../api/deepcave.plugins.hyperparameter.importances.html">
         deepcave.plugins.hyperparameter.importances
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../../api/deepcave.plugins.hyperparameter.parallel_coordinates.html">
         deepcave.plugins.hyperparameter.parallel_coordinates
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../../api/deepcave.plugins.hyperparameter.pdp.html">
         deepcave.plugins.hyperparameter.pdp
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../../api/deepcave.plugins.hyperparameter.symbolic_explanations.html">
         deepcave.plugins.hyperparameter.symbolic_explanations
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../../api/deepcave.plugins.objective.html">
       deepcave.plugins.objective
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../../api/deepcave.plugins.static.html">
       deepcave.plugins.static
      </a>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../../../../api/deepcave.plugins.summary.html">
       deepcave.plugins.summary
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
      <label for="toctree-checkbox-11">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../../api/deepcave.plugins.summary.configurations.html">
         deepcave.plugins.summary.configurations
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../../api/deepcave.plugins.summary.footprint.html">
         deepcave.plugins.summary.footprint
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../../api/deepcave.plugins.summary.overview.html">
         deepcave.plugins.summary.overview
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../../../api/deepcave.layouts.html">
     deepcave.layouts
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/>
    <label for="toctree-checkbox-12">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../../api/deepcave.layouts.header.html">
       deepcave.layouts.header
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../../api/deepcave.layouts.not_found.html">
       deepcave.layouts.not_found
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../../api/deepcave.layouts.sidebar.html">
       deepcave.layouts.sidebar
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../../../api/deepcave.evaluators.html">
     deepcave.evaluators
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/>
    <label for="toctree-checkbox-13">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../../api/deepcave.evaluators.ablation.html">
       deepcave.evaluators.ablation
      </a>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../../../../api/deepcave.evaluators.epm.html">
       deepcave.evaluators.epm
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/>
      <label for="toctree-checkbox-14">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../../api/deepcave.evaluators.epm.fanova_forest.html">
         deepcave.evaluators.epm.fanova_forest
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../../api/deepcave.evaluators.epm.random_forest.html">
         deepcave.evaluators.epm.random_forest
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../../api/deepcave.evaluators.epm.random_forest_surrogate.html">
         deepcave.evaluators.epm.random_forest_surrogate
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../../api/deepcave.evaluators.epm.utils.html">
         deepcave.evaluators.epm.utils
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../../api/deepcave.evaluators.fanova.html">
       deepcave.evaluators.fanova
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../../api/deepcave.evaluators.footprint.html">
       deepcave.evaluators.footprint
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../../api/deepcave.evaluators.lpi.html">
       deepcave.evaluators.lpi
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../../api/deepcave.evaluators.mo_ablation.html">
       deepcave.evaluators.mo_ablation
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../../api/deepcave.evaluators.mo_fanova.html">
       deepcave.evaluators.mo_fanova
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../../api/deepcave.evaluators.mo_lpi.html">
       deepcave.evaluators.mo_lpi
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../../../api/deepcave.utils.html">
     deepcave.utils
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/>
    <label for="toctree-checkbox-15">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../../api/deepcave.utils.cache.html">
       deepcave.utils.cache
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../../api/deepcave.utils.cast.html">
       deepcave.utils.cast
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../../api/deepcave.utils.compression.html">
       deepcave.utils.compression
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../../api/deepcave.utils.configs.html">
       deepcave.utils.configs
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../../api/deepcave.utils.configspace.html">
       deepcave.utils.configspace
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../../api/deepcave.utils.converters.html">
       deepcave.utils.converters
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../../api/deepcave.utils.dash.html">
       deepcave.utils.dash
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../../api/deepcave.utils.data_structures.html">
       deepcave.utils.data_structures
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../../api/deepcave.utils.docs.html">
       deepcave.utils.docs
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../../api/deepcave.utils.files.html">
       deepcave.utils.files
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../../api/deepcave.utils.hash.html">
       deepcave.utils.hash
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../../api/deepcave.utils.layout.html">
       deepcave.utils.layout
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../../api/deepcave.utils.logs.html">
       deepcave.utils.logs
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../../api/deepcave.utils.multi_objective_importance.html">
       deepcave.utils.multi_objective_importance
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../../api/deepcave.utils.notification.html">
       deepcave.utils.notification
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../../api/deepcave.utils.run_caches.html">
       deepcave.utils.run_caches
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../../api/deepcave.utils.styled_plotty.html">
       deepcave.utils.styled_plotty
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../../api/deepcave.utils.symbolic_regression.html">
       deepcave.utils.symbolic_regression
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../../api/deepcave.utils.url.html">
       deepcave.utils.url
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../../api/deepcave.utils.util.html">
       deepcave.utils.util
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../glossary.html">
   Glossary
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../faq.html">
   Frequently Asked Questions
  </a>
 </li>
</ul>

  </div>
</nav>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <h1>Source code for deepcave.evaluators.epm.fanova_forest</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright 2021-2024 The DeepCAVE Authors</span>
<span class="c1">#</span>
<span class="c1"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c1"># you may not use this file except in compliance with the License.</span>
<span class="c1"># You may obtain a copy of the License at</span>
<span class="c1">#</span>
<span class="c1">#   http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1">#</span>
<span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c1"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c1"># See the License for the specific language governing permissions and</span>
<span class="c1"># limitations under the License.</span>

<span class="c1"># noqa: D400</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd"># FanovaForest</span>

<span class="sd">The module provides utilities for creating a fANOVA forest.</span>

<span class="sd">It includes a FanovaForest wrapper for pyrfr.</span>
<span class="sd">fANOVA can be used for analyzing the importances of Hyperparameters.</span>

<span class="sd">## Classes</span>
<span class="sd">    - FanovaForest: A fANOVA forest wrapper for pyrfr.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">itertools</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">it</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyrfr</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyrfr.regression</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">regression</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyrfr.util</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ConfigSpace</span><span class="w"> </span><span class="kn">import</span> <span class="n">ConfigurationSpace</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">deepcave.evaluators.epm.random_forest</span><span class="w"> </span><span class="kn">import</span> <span class="n">RandomForest</span>


<div class="viewcode-block" id="FanovaForest">
<a class="viewcode-back" href="../../../../api/deepcave.evaluators.epm.fanova_forest.html#deepcave.evaluators.epm.fanova_forest.FanovaForest">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">FanovaForest</span><span class="p">(</span><span class="n">RandomForest</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A fANOVA forest wrapper for pyrfr.</span>

<span class="sd">    Properties</span>
<span class="sd">    ----------</span>
<span class="sd">    cutoffs : Tuple[float, float]</span>
<span class="sd">        The cutoffs of the model.</span>
<span class="sd">    percentiles : NDArray[floating]</span>
<span class="sd">        The percentiles of the data points Y.</span>
<span class="sd">    all_midpoints : List</span>
<span class="sd">        All midpoints tree wise for the whole forest.</span>
<span class="sd">    all_sizes : List</span>
<span class="sd">        All interval sizes tree wise for the whole forest.</span>
<span class="sd">    bounds : List[Tuple[float, float]</span>
<span class="sd">        Stores feature bounds.</span>
<span class="sd">    trees_total_variances : List</span>
<span class="sd">        The total variances of the trees.</span>
<span class="sd">    trees_total_variance : Any</span>
<span class="sd">        The total variance of a tree.</span>
<span class="sd">    trees_variance_fractions : Dict</span>
<span class="sd">        The variance fractions of the trees.</span>
<span class="sd">    V_U_total : Dict[Tuple[int, ...], List[Any]]</span>
<span class="sd">        Store variance-related information across all trees.</span>
<span class="sd">    V_U_individual : Dict[Tuple[int, ...], List[Any]]</span>
<span class="sd">        Store variance-related information for individual subsets.</span>
<span class="sd">    n_params : int</span>
<span class="sd">        The number of Hyperparameters to sample.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">configspace</span><span class="p">:</span> <span class="n">ConfigurationSpace</span><span class="p">,</span>
        <span class="n">n_trees</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
        <span class="n">ratio_features</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="n">min_samples_split</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">min_samples_leaf</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">max_depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">64</span><span class="p">,</span>
        <span class="n">max_nodes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="mi">20</span><span class="p">,</span>
        <span class="n">eps_purity</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-8</span><span class="p">,</span>
        <span class="n">bootstrapping</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">instance_features</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">pca_components</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
        <span class="n">cutoffs</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span>
        <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">configspace</span><span class="o">=</span><span class="n">configspace</span><span class="p">,</span>
            <span class="n">n_trees</span><span class="o">=</span><span class="n">n_trees</span><span class="p">,</span>
            <span class="n">ratio_features</span><span class="o">=</span><span class="n">ratio_features</span><span class="p">,</span>
            <span class="n">min_samples_split</span><span class="o">=</span><span class="n">min_samples_split</span><span class="p">,</span>
            <span class="n">min_samples_leaf</span><span class="o">=</span><span class="n">min_samples_leaf</span><span class="p">,</span>
            <span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth</span><span class="p">,</span>
            <span class="n">max_nodes</span><span class="o">=</span><span class="n">max_nodes</span><span class="p">,</span>
            <span class="n">eps_purity</span><span class="o">=</span><span class="n">eps_purity</span><span class="p">,</span>
            <span class="n">bootstrapping</span><span class="o">=</span><span class="n">bootstrapping</span><span class="p">,</span>
            <span class="n">instance_features</span><span class="o">=</span><span class="n">instance_features</span><span class="p">,</span>
            <span class="n">pca_components</span><span class="o">=</span><span class="n">pca_components</span><span class="p">,</span>
            <span class="n">log_y</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cutoffs</span> <span class="o">=</span> <span class="n">cutoffs</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_model</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">regression</span><span class="o">.</span><span class="n">base_tree</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the internal model.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        model : regression.base_tree</span>
<span class="sd">            Model which is used internally.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">regression</span><span class="o">.</span><span class="n">fanova_forest</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_train</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">Y</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Train the Random Forest on X and Y.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        X : np.ndarray</span>
<span class="sd">            Input data points.</span>
<span class="sd">        Y : np.ndarray</span>
<span class="sd">            Target values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_train</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">percentiles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>

        <span class="c1"># all midpoints and interval sizes tree wise for the whole forest</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_midpoints</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_sizes</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># getting split values</span>
        <span class="n">forest_split_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">all_split_values</span><span class="p">()</span>

        <span class="c1"># compute midpoints and interval sizes for variables in each tree</span>
        <span class="k">for</span> <span class="n">tree_split_values</span> <span class="ow">in</span> <span class="n">forest_split_values</span><span class="p">:</span>
            <span class="n">sizes</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">midpoints</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">split_vals</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tree_split_values</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]):</span>  <span class="c1"># categorical parameter</span>
                    <span class="c1"># check if the tree actually splits on this parameter</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">split_vals</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">midpoints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">split_vals</span><span class="p">)</span>
                        <span class="n">sizes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">split_vals</span><span class="p">)))</span>
                    <span class="c1"># if not, simply append 0 as the value with the number of categories as the</span>
                    <span class="c1"># size, that way this parameter will get 0 importance from this tree.</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">midpoints</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="mi">0</span><span class="p">,))</span>
                        <span class="n">sizes</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># add bounds to split values</span>
                    <span class="n">sv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">split_vals</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]])</span>
                    <span class="c1"># compute midpoints and sizes</span>
                    <span class="n">midpoints</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">sv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">sv</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
                    <span class="n">sizes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">sv</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">all_midpoints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">midpoints</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">all_sizes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sizes</span><span class="p">)</span>

        <span class="c1"># capital V in the paper</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trees_total_variances</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># dict of lists where the keys are tuples of the dimensions</span>
        <span class="c1"># and the value list contains \hat{f}_U for the individual trees</span>
        <span class="c1"># reset all the variance fractions computed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trees_variance_fractions</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">V_U_total</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">V_U_individual</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Set cut-off</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">set_cutoffs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cutoffs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">cutoffs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="c1"># recompute the trees&#39; total variance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trees_total_variance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">get_trees_total_variances</span><span class="p">()</span>

<div class="viewcode-block" id="FanovaForest.compute_marginals">
<a class="viewcode-back" href="../../../../api/deepcave.evaluators.epm.fanova_forest.html#deepcave.evaluators.epm.fanova_forest.FanovaForest.compute_marginals">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">compute_marginals</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">hp_ids</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]],</span> <span class="n">depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">]],]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the marginal of selected Hyperparameters.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        hp_ids: Union[List[int], Tuple[int, ...]]</span>
<span class="sd">            Contains the indices of the configspace for the selected Hyperparameters</span>
<span class="sd">            (starts with 0).</span>
<span class="sd">        depth: int</span>
<span class="sd">            The depth of the marginalization.</span>
<span class="sd">            Default value is 1.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Tuple[Dict[Tuple[int, ...], List[Any]],</span>
<span class="sd">        Dict[Tuple[int, ...], List[Any]],</span>
<span class="sd">            The marginal of selected Hyperparameters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hp_ids</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">hp_ids</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">hp_ids</span><span class="p">)</span>

        <span class="c1"># check if values has been previously computed</span>
        <span class="k">if</span> <span class="n">hp_ids</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">V_U_individual</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">V_U_individual</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">V_U_total</span>

        <span class="c1"># otherwise make sure all lower order marginals have been</span>
        <span class="c1"># computed, if not compute them</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">hp_ids</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">k</span> <span class="o">&gt;</span> <span class="n">depth</span><span class="p">:</span>
                <span class="k">break</span>

            <span class="k">for</span> <span class="n">sub_hp_ids</span> <span class="ow">in</span> <span class="n">it</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="n">hp_ids</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">sub_hp_ids</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">V_U_total</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">compute_marginals</span><span class="p">(</span><span class="n">sub_hp_ids</span><span class="p">)</span>

        <span class="c1"># now all lower order terms have been computed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">V_U_individual</span><span class="p">[</span><span class="n">hp_ids</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">V_U_total</span><span class="p">[</span><span class="n">hp_ids</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">hp_ids</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">V_U_individual</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">V_U_total</span>

        <span class="k">for</span> <span class="n">tree_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all_midpoints</span><span class="p">)):</span>
            <span class="c1"># collect all the midpoints and corresponding sizes for that tree</span>
            <span class="n">midpoints</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">all_midpoints</span><span class="p">[</span><span class="n">tree_idx</span><span class="p">][</span><span class="n">hp_id</span><span class="p">]</span> <span class="k">for</span> <span class="n">hp_id</span> <span class="ow">in</span> <span class="n">hp_ids</span><span class="p">]</span>
            <span class="n">sizes</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">all_sizes</span><span class="p">[</span><span class="n">tree_idx</span><span class="p">][</span><span class="n">hp_id</span><span class="p">]</span> <span class="k">for</span> <span class="n">hp_id</span> <span class="ow">in</span> <span class="n">hp_ids</span><span class="p">]</span>
            <span class="n">stat</span> <span class="o">=</span> <span class="n">pyrfr</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">weighted_running_stats</span><span class="p">()</span>

            <span class="n">prod_midpoints</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">midpoints</span><span class="p">)</span>
            <span class="n">prod_sizes</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">sizes</span><span class="p">)</span>

            <span class="n">sample</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_params</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

            <span class="c1"># make prediction for all midpoints and weigh them by the corresponding size</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">prod_midpoints</span><span class="p">,</span> <span class="n">prod_sizes</span><span class="p">)):</span>
                <span class="n">sample</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">hp_ids</span><span class="p">)]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

                <span class="n">ls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">marginal_prediction_stat_of_tree</span><span class="p">(</span><span class="n">tree_idx</span><span class="p">,</span> <span class="n">sample</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
                <span class="c1"># self.logger.debug(&quot;%s, %s&quot;, (sample, ls.mean()))</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">ls</span><span class="o">.</span><span class="n">mean</span><span class="p">()):</span>
                    <span class="n">stat</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">ls</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">s</span><span class="p">))</span> <span class="o">*</span> <span class="n">ls</span><span class="o">.</span><span class="n">sum_of_weights</span><span class="p">())</span>

            <span class="c1"># line 10 in algorithm 2</span>
            <span class="c1"># note that V_U^2 can be computed by var(\hat a)^2 - \sum_{subU} var(f_subU)^2</span>
            <span class="c1"># which is why, \hat{f} is never computed in the code, but</span>
            <span class="c1"># appears in the pseudo code</span>
            <span class="n">V_U_total</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="n">V_U_individual</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

            <span class="k">if</span> <span class="n">stat</span><span class="o">.</span><span class="n">sum_of_weights</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">V_U_total</span> <span class="o">=</span> <span class="n">stat</span><span class="o">.</span><span class="n">variance_population</span><span class="p">()</span>
                <span class="n">V_U_individual</span> <span class="o">=</span> <span class="n">stat</span><span class="o">.</span><span class="n">variance_population</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">hp_ids</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="n">k</span> <span class="o">&gt;</span> <span class="n">depth</span><span class="p">:</span>
                        <span class="k">break</span>

                    <span class="k">for</span> <span class="n">sub_dims</span> <span class="ow">in</span> <span class="n">it</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="n">hp_ids</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
                        <span class="n">V_U_individual</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">V_U_individual</span><span class="p">[</span><span class="n">sub_dims</span><span class="p">][</span><span class="n">tree_idx</span><span class="p">]</span>
                <span class="n">V_U_individual</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">V_U_individual</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">V_U_individual</span><span class="p">[</span><span class="n">hp_ids</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">V_U_individual</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">V_U_total</span><span class="p">[</span><span class="n">hp_ids</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">V_U_total</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">V_U_individual</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">V_U_total</span></div>
</div>

</pre></div>

              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
              
          </main>
          

      </div>
    </div>
  
  <script src="../../../../_static/js/index.9ea38e314b9e6d9dab77.js"></script>
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright Copyright 2025, S. Segel and H. Graf and E. Bergman and K. Thieme and L. Fehring and A. Tornede and R. Sass and A. Biedenkapp and F. Hutter and M. Lindauer.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a>
7.4.7. Template is modified version of <a
href="https://pydata-sphinx-theme.readthedocs.io">PyData Sphinx Theme</a>. <br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>